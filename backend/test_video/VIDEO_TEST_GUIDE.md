# è§†é¢‘åŠŸèƒ½æµ‹è¯•æŒ‡å—

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬æµ‹è¯•æŒ‡å—ç”¨äºéªŒè¯è§†é¢‘è®¾å¤‡ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- åç«¯æ•°æ®åº“è¿æ¥
- APIæ¥å£åŠŸèƒ½
- è§†é¢‘è®¾å¤‡CRUDæ“ä½œ
- è§†é¢‘æµåœ°å€è·å–

---

## ğŸ”§ æµ‹è¯•å‰å‡†å¤‡

### 1. ç¡®ä¿MySQLæ•°æ®åº“å·²å¯åŠ¨
```bash
# æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
# Windows: æœåŠ¡ç®¡ç†å™¨ä¸­æŸ¥çœ‹MySQLæœåŠ¡
# æˆ–ä½¿ç”¨å‘½ä»¤è¡Œè¿æ¥æµ‹è¯•
mysql -u root -p
```

### 2. å¯åŠ¨åç«¯æœåŠ¡
```bash
cd backend
python main.py
```

é¢„æœŸè¾“å‡ºï¼š
```
INFO:     Uvicorn running on http://127.0.0.1:8000
INFO:     Application startup complete.
```

### 3. å®‰è£…æµ‹è¯•ä¾èµ–ï¼ˆå¦‚æœéœ€è¦ï¼‰
```bash
pip install requests
```

---

## ğŸ§ª æµ‹è¯•æ–¹æ³•

### æ–¹æ³•ä¸€ï¼šä½¿ç”¨APIæµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰

è¿™æ˜¯æœ€æ–¹ä¾¿çš„æµ‹è¯•æ–¹æ³•ï¼Œä¼šè‡ªåŠ¨æµ‹è¯•æ‰€æœ‰åŠŸèƒ½ã€‚

```bash
cd backend
python test_video/test_video_api.py
```

**æµ‹è¯•å†…å®¹ï¼š**
1. âœ“ åç«¯æœåŠ¡è¿æ¥æµ‹è¯•
2. âœ“ è·å–è§†é¢‘è®¾å¤‡åˆ—è¡¨
3. âœ“ åˆ›å»ºæ–°è§†é¢‘è®¾å¤‡
4. âœ“ æ›´æ–°è§†é¢‘è®¾å¤‡ä¿¡æ¯
5. âœ“ è·å–è§†é¢‘æµåœ°å€
6. âœ“ åˆ é™¤è§†é¢‘è®¾å¤‡ï¼ˆå¯é€‰ï¼‰

**é¢„æœŸç»“æœï¼š**
- æ‰€æœ‰æµ‹è¯•é¡¹æ˜¾ç¤º âœ“ è¡¨ç¤ºé€šè¿‡
- æ˜¾ç¤ºè¯¦ç»†çš„è¯·æ±‚å’Œå“åº”æ•°æ®
- åˆ›å»ºçš„æµ‹è¯•è®¾å¤‡IDä¼šè¢«è®°å½•

---

### æ–¹æ³•äºŒï¼šç›´æ¥æ•°æ®åº“æµ‹è¯•

å¦‚æœæƒ³ç›´æ¥åœ¨æ•°æ®åº“ä¸­æ’å…¥æµ‹è¯•æ•°æ®ï¼š

```bash
cd backend
python test_video/init_video_test_data.py
```

é€‰æ‹©æ“ä½œ 1 åˆå§‹åŒ–æµ‹è¯•æ•°æ®ï¼Œä¼šè‡ªåŠ¨æ’å…¥4ä¸ªç¤ºä¾‹æ‘„åƒå¤´ï¼š
- å¤§é—¨å£æ‘„åƒå¤´
- åœè½¦åœºæ‘„åƒå¤´
- ä»“åº“æ‘„åƒå¤´
- åŠå…¬åŒºæ‘„åƒå¤´

---

### æ–¹æ³•ä¸‰ï¼šä½¿ç”¨Postman/Thunder Clientæµ‹è¯•

#### 1. è·å–æ‰€æœ‰è§†é¢‘è®¾å¤‡
```
GET http://127.0.0.1:8000/video/
```

#### 2. åˆ›å»ºè§†é¢‘è®¾å¤‡
```
POST http://127.0.0.1:8000/video/
Content-Type: application/json

{
  "name": "æµ‹è¯•æ‘„åƒå¤´",
  "ip_address": "192.168.1.100",
  "port": 554,
  "username": "admin",
  "password": "admin123",
  "stream_url": "rtsp://192.168.1.100:554/Streaming/Channels/101",
  "latitude": 39.9042,
  "longitude": 116.4074,
  "status": "online",
  "remark": "æµ‹è¯•ç”¨æ‘„åƒå¤´"
}
```

#### 3. æ›´æ–°è§†é¢‘è®¾å¤‡
```
PUT http://127.0.0.1:8000/video/{video_id}
Content-Type: application/json

{
  "name": "æ›´æ–°åçš„åç§°",
  "status": "offline"
}
```

#### 4. è·å–è§†é¢‘æµåœ°å€
```
GET http://127.0.0.1:8000/video/stream/{video_id}
```

#### 5. åˆ é™¤è§†é¢‘è®¾å¤‡
```
DELETE http://127.0.0.1:8000/video/{video_id}
```

---

### æ–¹æ³•å››ï¼šä½¿ç”¨Pythonäº¤äº’å¼æµ‹è¯•

```python
import requests

# æµ‹è¯•è¿æ¥
response = requests.get("http://127.0.0.1:8000")
print(response.json())

# è·å–è§†é¢‘åˆ—è¡¨
response = requests.get("http://127.0.0.1:8000/video/")
print(response.json())

# åˆ›å»ºè§†é¢‘è®¾å¤‡
data = {
    "name": "æµ‹è¯•æ‘„åƒå¤´",
    "ip_address": "192.168.1.100",
    "port": 554,
    "stream_url": "rtsp://192.168.1.100:554/stream",
    "status": "online"
}
response = requests.post("http://127.0.0.1:8000/video/", json=data)
print(response.json())
```

---

## ğŸ” æ•°æ®åº“éªŒè¯

### ç›´æ¥æŸ¥è¯¢MySQLæ•°æ®åº“
```sql
-- è¿æ¥æ•°æ®åº“
USE smart_helmet_db;

-- æŸ¥çœ‹è§†é¢‘è®¾å¤‡è¡¨ç»“æ„
DESC video_devices;

-- æŸ¥è¯¢æ‰€æœ‰è§†é¢‘è®¾å¤‡
SELECT * FROM video_devices;

-- æŸ¥è¯¢åœ¨çº¿è®¾å¤‡
SELECT id, name, ip_address, status FROM video_devices WHERE status = 'online';

-- æŸ¥è¯¢ç‰¹å®šè®¾å¤‡
SELECT * FROM video_devices WHERE name LIKE '%æ‘„åƒå¤´%';
```

---

## ğŸ“Š é¢„æœŸæµ‹è¯•ç»“æœ

### æˆåŠŸçš„APIå“åº”ç¤ºä¾‹

**GET /video/ (è·å–åˆ—è¡¨)**
```json
[
  {
    "id": 1,
    "name": "å¤§é—¨å£æ‘„åƒå¤´",
    "ip_address": "192.168.1.100",
    "port": 554,
    "username": "admin",
    "password": "admin123",
    "stream_url": "rtsp://192.168.1.100:554/Streaming/Channels/101",
    "latitude": 39.9042,
    "longitude": 116.4074,
    "status": "online",
    "remark": "ä¸»å…¥å£ç›‘æ§",
    "is_active": 1
  }
]
```

**POST /video/ (åˆ›å»ºæˆåŠŸ)**
```json
{
  "id": 5,
  "name": "æµ‹è¯•æ‘„åƒå¤´",
  ...
}
```

**GET /video/stream/1 (è·å–æµåœ°å€)**
```json
{
  "url": "rtsp://192.168.1.100:554/Streaming/Channels/101"
}
```

---

## âŒ å¸¸è§é—®é¢˜æ’æŸ¥

### 1. æ— æ³•è¿æ¥åç«¯æœåŠ¡
**é”™è¯¯**: `Connection refused` æˆ– `Max retries exceeded`

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦å¯åŠ¨: `python backend/main.py`
- ç¡®è®¤ç«¯å£8000æœªè¢«å ç”¨
- æ£€æŸ¥é˜²ç«å¢™è®¾ç½®

### 2. æ•°æ®åº“è¿æ¥å¤±è´¥
**é”™è¯¯**: `Can't connect to MySQL server`

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®è®¤MySQLæœåŠ¡å·²å¯åŠ¨
- æ£€æŸ¥database.pyä¸­çš„è¿æ¥é…ç½®ï¼š
  ```python
  SQLALCHEMY_DATABASE_URL = "mysql+pymysql://root:123456@127.0.0.1:3306/smart_helmet_db?charset=utf8mb4"
  ```
- ç¡®è®¤æ•°æ®åº“å·²åˆ›å»º: `CREATE DATABASE smart_helmet_db;`

### 3. 404 Not Found
**é”™è¯¯**: `{"detail":"Not found"}`

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥APIè·¯å¾„æ˜¯å¦æ­£ç¡®
- ç¡®è®¤routerå·²åœ¨main.pyä¸­æ³¨å†Œ: `app.include_router(video_controller.router)`

### 4. 422 Validation Error
**é”™è¯¯**: `{"detail":[{"type":"missing","loc":["body","name"],"msg":"Field required"}]}`

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥è¯·æ±‚ä½“æ ¼å¼æ˜¯å¦ç¬¦åˆVideoCreate schema
- ç¡®ä¿æ‰€æœ‰å¿…å¡«å­—æ®µéƒ½å·²æä¾›

---

## ğŸ¯ æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] åç«¯æœåŠ¡æˆåŠŸå¯åŠ¨
- [ ] MySQLæ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] GET /video/ æˆåŠŸè·å–è®¾å¤‡åˆ—è¡¨
- [ ] POST /video/ æˆåŠŸåˆ›å»ºè®¾å¤‡
- [ ] PUT /video/{id} æˆåŠŸæ›´æ–°è®¾å¤‡
- [ ] GET /video/stream/{id} æˆåŠŸè·å–æµåœ°å€
- [ ] DELETE /video/{id} æˆåŠŸåˆ é™¤è®¾å¤‡
- [ ] æ•°æ®åº“ä¸­æ•°æ®ä¸APIå“åº”ä¸€è‡´
- [ ] æ—¥å¿—æ–‡ä»¶æ­£å¸¸è®°å½•æ“ä½œ

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```
æµ‹è¯•æ—¶é—´: 2025-12-28
æµ‹è¯•äººå‘˜: [ä½ çš„åå­—]
ç¯å¢ƒ: Windows / Python 3.x / MySQL 8.0

æµ‹è¯•ç»“æœ:
1. APIè¿æ¥æµ‹è¯•         [ é€šè¿‡ / å¤±è´¥ ]
2. è·å–è®¾å¤‡åˆ—è¡¨         [ é€šè¿‡ / å¤±è´¥ ]
3. åˆ›å»ºè§†é¢‘è®¾å¤‡         [ é€šè¿‡ / å¤±è´¥ ]
4. æ›´æ–°è§†é¢‘è®¾å¤‡         [ é€šè¿‡ / å¤±è´¥ ]
5. è·å–æµåœ°å€          [ é€šè¿‡ / å¤±è´¥ ]
6. åˆ é™¤è§†é¢‘è®¾å¤‡         [ é€šè¿‡ / å¤±è´¥ ]

é‡åˆ°çš„é—®é¢˜:
[æè¿°é—®é¢˜]

å¤‡æ³¨:
[å…¶ä»–è¯´æ˜]
```

---

## ğŸš€ ä¸‹ä¸€æ­¥

æµ‹è¯•é€šè¿‡åï¼Œå¯ä»¥ï¼š
1. æµ‹è¯•å‰ç«¯é›†æˆï¼ˆå¯åŠ¨å‰ç«¯æœåŠ¡ï¼‰
2. æµ‹è¯•è§†é¢‘æµæ’­æ”¾åŠŸèƒ½
3. æµ‹è¯•åœ°å›¾æ ‡è®°åŠŸèƒ½
4. è¿›è¡Œå‹åŠ›æµ‹è¯•å’Œå¹¶å‘æµ‹è¯•

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
- backend/logs/ ç›®å½•ä¸‹çš„æ—¥å¿—æ–‡ä»¶
- æ§åˆ¶å°è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯
- MySQLé”™è¯¯æ—¥å¿—
